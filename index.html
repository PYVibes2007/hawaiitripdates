<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hawaii Trip Calendar</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        h1 {
            margin-bottom: 10px;
            color: #333;
            font-size: 28px;
        }
        
        .legend {
            display: flex;
            gap: 25px;
            margin: 20px 0 30px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 6px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .blackout { background: #000000; }
        .preferred { background: #4CAF50; }
        .both { background: linear-gradient(135deg, #000000 50%, #4CAF50 50%); }
        
        .controls {
            margin-bottom: 30px;
            padding: 20px;
            background: #f0f8ff;
            border-radius: 6px;
        }
        
        .controls h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .control-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .control-group {
            margin-bottom: 0;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 14px;
        }
        
        .control-group input, .control-group select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 300px;
        }
        
        #personName {
            width: 300px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .btn-add {
            background: #2196F3;
            color: white;
        }
        
        .btn-add:hover {
            background: #1976D2;
        }
        
        .btn-add:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .calendars {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
            margin-top: 30px;
        }
        
        @media (max-width: 1200px) {
            .calendars {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .calendars {
                grid-template-columns: 1fr;
            }
        }
        
        .month-calendar {
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .month-header {
            background: #2196F3;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
        }
        
        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: #f5f5f5;
            border-bottom: 1px solid #ddd;
        }
        
        .weekday {
            padding: 8px;
            text-align: center;
            font-weight: 600;
            font-size: 12px;
            color: #666;
        }
        
        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: white;
        }
        
        .day {
            aspect-ratio: 1;
            padding: 8px;
            border: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            cursor: pointer;
            position: relative;
        }
        
        .day:hover {
            background: #f0f0f0;
        }
        
        .day.empty {
            cursor: default;
            background: #fafafa;
        }
        
        .day.empty:hover {
            background: #fafafa;
        }
        
        .day.blackout {
            background: #000000;
            color: white;
            font-weight: 600;
        }
        
        .day.preferred {
            background: #4CAF50;
            color: white;
            font-weight: 600;
        }
        
        .day.both {
            background: linear-gradient(135deg, #000000 50%, #4CAF50 50%);
            color: white;
            font-weight: 600;
        }
        
        .current-dates {
            margin-top: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 6px;
        }
        
        .current-dates h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .date-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        @media (max-width: 900px) {
            .date-list {
                grid-template-columns: 1fr;
            }
        }
        
        .date-item {
            padding: 10px;
            background: white;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #2196F3;
        }
        
        .date-item.blackout {
            border-left-color: #000000;
        }
        
        .date-item.preferred {
            border-left-color: #4CAF50;
        }
        
        .btn-remove {
            background: #f44336;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .btn-remove:hover {
            background: #d32f2f;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hawaii Trip Planning Calendar</h1>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color blackout"></div>
                <span>Blackout Dates</span>
            </div>
            <div class="legend-item">
                <div class="legend-color preferred"></div>
                <span>Preferred Dates</span>
            </div>
            <div class="legend-item">
                <div class="legend-color both"></div>
                <span>Both (Overlap)</span>
            </div>
        </div>
        
        <div class="controls">
            <h3>Add Dates</h3>
            <div class="control-grid">
                <div class="control-group">
                    <label>Your Name:</label>
                    <input type="text" id="personName" placeholder="Enter your name">
                </div>
                <div class="control-group">
                    <label>Date Type:</label>
                    <select id="dateType">
                        <option value="blackout">Blackout Date</option>
                        <option value="preferred">Preferred Date</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Start Date:</label>
                    <input type="date" id="startDate">
                </div>
                <div class="control-group">
                    <label>End Date (optional, leave blank for single day):</label>
                    <input type="date" id="endDate">
                </div>
            </div>
            <div class="control-group" style="margin-bottom: 15px;">
                <label style="display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="isRecurring" style="width: auto;">
                    <span>Recurring monthly (repeats these dates every month)</span>
                </label>
            </div>
            <div class="button-group">
                <button class="btn-add" id="addButton">Add Dates</button>
            </div>
        </div>
        
        <div id="loadingMessage" class="loading">Loading calendar data...</div>
        
        <div class="calendars" id="calendars" style="display: none;"></div>
        
        <div class="current-dates" id="currentDatesSection" style="display: none;">
            <h3>Current Date Ranges</h3>
            <div class="date-list" id="dateList"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB24LffDy4GWEi8p311rlcsHvKMH2ZcdDc",
            authDomain: "hawaii-trip-9c1a6.firebaseapp.com",
            projectId: "hawaii-trip-9c1a6",
            storageBucket: "hawaii-trip-9c1a6.firebasestorage.app",
            messagingSenderId: "216744048411",
            appId: "1:216744048411:web:226ab6ae7824dc1bfe45be"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Global data arrays
        let blackoutDates = [];
        let preferredDates = [];
        let recurringBlackoutDates = [];
        let recurringPreferredDates = [];

        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                           'July', 'August', 'September', 'October', 'November', 'December'];
        
        const weekdayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

        // Load data from Firebase
        async function loadData() {
            try {
                // Listen for real-time updates
                onSnapshot(collection(db, 'dates'), (snapshot) => {
                    blackoutDates = [];
                    preferredDates = [];
                    recurringBlackoutDates = [];
                    recurringPreferredDates = [];

                    snapshot.forEach((doc) => {
                        const data = { id: doc.id, ...doc.data() };
                        
                        if (data.isRecurring) {
                            if (data.type === 'blackout') {
                                recurringBlackoutDates.push(data);
                            } else {
                                recurringPreferredDates.push(data);
                            }
                        } else {
                            if (data.type === 'blackout') {
                                blackoutDates.push(data);
                            } else {
                                preferredDates.push(data);
                            }
                        }
                    });

                    renderCalendars();
                    document.getElementById('loadingMessage').style.display = 'none';
                    document.getElementById('calendars').style.display = 'grid';
                    document.getElementById('currentDatesSection').style.display = 'block';
                });
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loadingMessage').textContent = 'Error loading data. Please refresh the page.';
            }
        }

        function isDateInRange(date, ranges) {
            const dateStr = date.toISOString().split('T')[0];
            return ranges.some(range => {
                return dateStr >= range.start && dateStr <= range.end;
            });
        }
        
        function isDateInRecurringRange(date, recurringRanges) {
            const day = date.getDate();
            return recurringRanges.some(range => {
                return day >= range.startDay && day <= range.endDay;
            });
        }
        
        function renderCalendars() {
            const calendarsDiv = document.getElementById('calendars');
            calendarsDiv.innerHTML = '';
            
            // Show August 2026 through March 2027
            const startDate = new Date(2026, 7, 1); // August 2026
            const endDate = new Date(2027, 3, 1); // March 2027
            
            let currentDate = new Date(startDate);
            
            while (currentDate < endDate) {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                
                const monthDiv = document.createElement('div');
                monthDiv.className = 'month-calendar';
                
                const header = document.createElement('div');
                header.className = 'month-header';
                header.textContent = `${monthNames[month]} ${year}`;
                monthDiv.appendChild(header);
                
                const weekdays = document.createElement('div');
                weekdays.className = 'weekdays';
                weekdayNames.forEach(day => {
                    const weekday = document.createElement('div');
                    weekday.className = 'weekday';
                    weekday.textContent = day;
                    weekdays.appendChild(weekday);
                });
                monthDiv.appendChild(weekdays);
                
                const days = document.createElement('div');
                days.className = 'days';
                
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                
                // Empty cells before month starts
                for (let i = 0; i < firstDay; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'day empty';
                    days.appendChild(emptyDay);
                }
                
                // Days of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'day';
                    dayDiv.textContent = day;
                    
                    const date = new Date(year, month, day);
                    const isBlackout = isDateInRange(date, blackoutDates) || isDateInRecurringRange(date, recurringBlackoutDates);
                    const isPreferred = isDateInRange(date, preferredDates) || isDateInRecurringRange(date, recurringPreferredDates);
                    
                    if (isBlackout && isPreferred) {
                        dayDiv.classList.add('both');
                    } else if (isBlackout) {
                        dayDiv.classList.add('blackout');
                    } else if (isPreferred) {
                        dayDiv.classList.add('preferred');
                    }
                    
                    days.appendChild(dayDiv);
                }
                
                monthDiv.appendChild(days);
                calendarsDiv.appendChild(monthDiv);
                
                currentDate.setMonth(currentDate.getMonth() + 1);
            }
            
            updateDateList();
        }
        
        async function addDateRange() {
            const personName = document.getElementById('personName').value.trim();
            const type = document.getElementById('dateType').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value || startDate;
            const isRecurring = document.getElementById('isRecurring').checked;
            
            if (!personName) {
                alert('Please enter your name');
                return;
            }
            
            if (!startDate) {
                alert('Please select a start date');
                return;
            }

            // Disable button while saving
            const addButton = document.getElementById('addButton');
            addButton.disabled = true;
            addButton.textContent = 'Adding...';
            
            try {
                if (isRecurring) {
                    const startDay = new Date(startDate + 'T00:00:00').getDate();
                    const endDay = new Date(endDate + 'T00:00:00').getDate();
                    
                    await addDoc(collection(db, 'dates'), {
                        type: type,
                        startDay: startDay,
                        endDay: endDay,
                        person: personName,
                        isRecurring: true
                    });
                } else {
                    await addDoc(collection(db, 'dates'), {
                        type: type,
                        start: startDate,
                        end: endDate,
                        person: personName,
                        isRecurring: false
                    });
                }
                
                // Clear inputs
                document.getElementById('personName').value = '';
                document.getElementById('startDate').value = '';
                document.getElementById('endDate').value = '';
                document.getElementById('isRecurring').checked = false;
            } catch (error) {
                console.error('Error adding date:', error);
                alert('Error adding date. Please try again.');
            } finally {
                addButton.disabled = false;
                addButton.textContent = 'Add Dates';
            }
        }
        
        async function removeDate(id) {
            if (confirm('Delete this date range?')) {
                try {
                    await deleteDoc(doc(db, 'dates', id));
                } catch (error) {
                    console.error('Error removing date:', error);
                    alert('Error removing date. Please try again.');
                }
            }
        }
        
        function updateDateList() {
            const listDiv = document.getElementById('dateList');
            listDiv.innerHTML = '';
            
            // Add blackout dates
            blackoutDates.forEach((date) => {
                const item = document.createElement('div');
                item.className = 'date-item blackout';
                
                const info = document.createElement('div');
                const startFormatted = new Date(date.start + 'T00:00:00').toLocaleDateString();
                const endFormatted = new Date(date.end + 'T00:00:00').toLocaleDateString();
                const dateRange = date.start === date.end ? startFormatted : `${startFormatted} - ${endFormatted}`;
                info.innerHTML = `<strong>Blackout:</strong> ${dateRange} <em>(${date.person})</em>`;
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'btn-remove';
                removeBtn.textContent = 'Delete';
                removeBtn.onclick = () => removeDate(date.id);
                
                item.appendChild(info);
                item.appendChild(removeBtn);
                listDiv.appendChild(item);
            });
            
            // Add recurring blackout dates
            recurringBlackoutDates.forEach((date) => {
                const item = document.createElement('div');
                item.className = 'date-item blackout';
                
                const info = document.createElement('div');
                const dayRange = date.startDay === date.endDay 
                    ? `Day ${date.startDay}` 
                    : `Days ${date.startDay}-${date.endDay}`;
                info.innerHTML = `<strong>Blackout:</strong> ${dayRange} of every month <em>(${date.person} - recurring)</em>`;
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'btn-remove';
                removeBtn.textContent = 'Delete';
                removeBtn.onclick = () => removeDate(date.id);
                
                item.appendChild(info);
                item.appendChild(removeBtn);
                listDiv.appendChild(item);
            });
            
            // Add preferred dates
            preferredDates.forEach((date) => {
                const item = document.createElement('div');
                item.className = 'date-item preferred';
                
                const info = document.createElement('div');
                const startFormatted = new Date(date.start + 'T00:00:00').toLocaleDateString();
                const endFormatted = new Date(date.end + 'T00:00:00').toLocaleDateString();
                const dateRange = date.start === date.end ? startFormatted : `${startFormatted} - ${endFormatted}`;
                info.innerHTML = `<strong>Preferred:</strong> ${dateRange} <em>(${date.person})</em>`;
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'btn-remove';
                removeBtn.textContent = 'Delete';
                removeBtn.onclick = () => removeDate(date.id);
                
                item.appendChild(info);
                item.appendChild(removeBtn);
                listDiv.appendChild(item);
            });
            
            // Add recurring preferred dates
            recurringPreferredDates.forEach((date) => {
                const item = document.createElement('div');
                item.className = 'date-item preferred';
                
                const info = document.createElement('div');
                const dayRange = date.startDay === date.endDay 
                    ? `Day ${date.startDay}` 
                    : `Days ${date.startDay}-${date.endDay}`;
                info.innerHTML = `<strong>Preferred:</strong> ${dayRange} of every month <em>(${date.person} - recurring)</em>`;
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'btn-remove';
                removeBtn.textContent = 'Delete';
                removeBtn.onclick = () => removeDate(date.id);
                
                item.appendChild(info);
                item.appendChild(removeBtn);
                listDiv.appendChild(item);
            });
        }
        
        // Initial load
        loadData();
        
        // Set up button event listener
        document.getElementById('addButton').addEventListener('click', addDateRange);
    </script>
</body>
</html>
